# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Literal Instead of Constant](#l-2-literal-instead-of-constant)
  - [L-3: Modifier Invoked Only Once](#l-3-modifier-invoked-only-once)
  - [L-4: Internal Function Used Only Once](#l-4-internal-function-used-only-once)
  - [L-5: Unused Error](#l-5-unused-error)
  - [L-6: Unused State Variable](#l-6-unused-state-variable)
  - [L-7: Uninitialized Local Variable](#l-7-uninitialized-local-variable)
  - [L-8: Costly operations inside loop](#l-8-costly-operations-inside-loop)
  - [L-9: State Change Without Event](#l-9-state-change-without-event)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 8 |
| Total nSLOC | 1033 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| contracts/diamond/DiamondInit.sol | 26 |
| contracts/diamond/ScrumPokerDeployer.sol | 104 |
| contracts/diamond/ScrumPokerDiamond.sol | 59 |
| contracts/diamond/ScrumPokerStorage.sol | 185 |
| contracts/diamond/facets/AdminFacet.sol | 127 |
| contracts/diamond/facets/CeremonyFacet.sol | 154 |
| contracts/diamond/facets/NFTFacet.sol | 113 |
| contracts/diamond/facets/VotingFacet.sol | 265 |
| **Total** | **1033** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 0 |
| Low | 9 |


# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>12 Found Instances</summary>


- Found in contracts/diamond/ScrumPokerDiamond.sol [Line: 80](contracts/diamond/ScrumPokerDiamond.sol#L80)

	```solidity
	    function withdrawEther(address payable _to, uint256 _amount) external nonReentrant onlyOwner {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 100](contracts/diamond/facets/AdminFacet.sol#L100)

	```solidity
	    function updateExchangeRate(uint256 newRate) external onlyRole(ScrumPokerStorage.PRICE_UPDATER_ROLE) {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 111](contracts/diamond/facets/AdminFacet.sol#L111)

	```solidity
	    function setPriceOracle(address _priceOracle) external onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 120](contracts/diamond/facets/AdminFacet.sol#L120)

	```solidity
	    function pause() external onlyRole(ScrumPokerStorage.ADMIN_ROLE) whenNotPaused {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 128](contracts/diamond/facets/AdminFacet.sol#L128)

	```solidity
	    function unpause() external onlyRole(ScrumPokerStorage.ADMIN_ROLE) whenPaused {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 138](contracts/diamond/facets/AdminFacet.sol#L138)

	```solidity
	    function grantRole(bytes32 role, address account) external onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 147](contracts/diamond/facets/AdminFacet.sol#L147)

	```solidity
	    function revokeRole(bytes32 role, address account) external onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 216](contracts/diamond/facets/AdminFacet.sol#L216)

	```solidity
	    function updateVestingPeriod(uint256 _newVestingPeriod) external onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 240](contracts/diamond/facets/AdminFacet.sol#L240)

	```solidity
	    function withdrawFunds(address payable _to, uint256 _amount) external onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 261](contracts/diamond/facets/AdminFacet.sol#L261)

	```solidity
	    function withdrawERC20(address _token, address _to, uint256 _amount) external onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/NFTFacet.sol [Line: 115](contracts/diamond/facets/NFTFacet.sol#L115)

	```solidity
	    function withdrawFunds() external nonReentrant onlyRole(ScrumPokerStorage.ADMIN_ROLE) {
	```

- Found in contracts/diamond/facets/NFTFacet.sol [Line: 208](contracts/diamond/facets/NFTFacet.sol#L208)

	```solidity
	        onlyRole(ScrumPokerStorage.ADMIN_ROLE) 
	```

</details>



## L-2: Literal Instead of Constant

Define and use `constant` variables instead of using literals. If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>3 Found Instances</summary>


- Found in contracts/diamond/facets/CeremonyFacet.sol [Line: 296](contracts/diamond/facets/CeremonyFacet.sol#L296)

	```solidity
	            j /= 10;
	```

- Found in contracts/diamond/facets/CeremonyFacet.sol [Line: 302](contracts/diamond/facets/CeremonyFacet.sol#L302)

	```solidity
	            bstr[--k] = bytes1(uint8(48 + j % 10));
	```

- Found in contracts/diamond/facets/CeremonyFacet.sol [Line: 303](contracts/diamond/facets/CeremonyFacet.sol#L303)

	```solidity
	            j /= 10;
	```

</details>



## L-3: Modifier Invoked Only Once

Consider removing the modifier or inlining the logic into the calling function.

<details><summary>3 Found Instances</summary>


- Found in contracts/diamond/facets/AdminFacet.sol [Line: 56](contracts/diamond/facets/AdminFacet.sol#L56)

	```solidity
	    modifier whenNotPaused() {
	```

- Found in contracts/diamond/facets/AdminFacet.sol [Line: 64](contracts/diamond/facets/AdminFacet.sol#L64)

	```solidity
	    modifier whenPaused() {
	```

- Found in contracts/diamond/facets/NFTFacet.sol [Line: 49](contracts/diamond/facets/NFTFacet.sol#L49)

	```solidity
	    modifier whenNotPaused() {
	```

</details>



## L-4: Internal Function Used Only Once

Instead of separating the logic into a separate function, consider inlining the logic into the calling function. This can reduce the number of function calls and improve readability.

<details><summary>5 Found Instances</summary>


- Found in contracts/diamond/ScrumPokerStorage.sol [Line: 155](contracts/diamond/ScrumPokerStorage.sol#L155)

	```solidity
	    function getStorageVersion() internal view returns (uint256) {
	```

- Found in contracts/diamond/ScrumPokerStorage.sol [Line: 191](contracts/diamond/ScrumPokerStorage.sol#L191)

	```solidity
	    function registerCeremonyCode(string memory code) internal returns (bytes32) {
	```

- Found in contracts/diamond/ScrumPokerStorage.sol [Line: 203](contracts/diamond/ScrumPokerStorage.sol#L203)

	```solidity
	    function getCeremonyCodeHash(string memory code) internal returns (bytes32) {
	```

- Found in contracts/diamond/ScrumPokerStorage.sol [Line: 295](contracts/diamond/ScrumPokerStorage.sol#L295)

	```solidity
	    function getCeremonyByHash(bytes32 codeHash) internal view returns (Ceremony storage) {
	```

- Found in contracts/diamond/facets/CeremonyFacet.sol [Line: 288](contracts/diamond/facets/CeremonyFacet.sol#L288)

	```solidity
	    function uint2str(uint256 _i) internal pure returns (string memory) {
	```

</details>



## L-5: Unused Error

Consider using or removing the unused error.

<details><summary>2 Found Instances</summary>


- Found in contracts/diamond/ScrumPokerDiamond.sol [Line: 29](contracts/diamond/ScrumPokerDiamond.sol#L29)

	```solidity
	    error ReentrancyGuardError();
	```

- Found in contracts/diamond/ScrumPokerStorage.sol [Line: 138](contracts/diamond/ScrumPokerStorage.sol#L138)

	```solidity
	    error CeremonyAlreadyExists(string code);
	```

</details>



## L-6: Unused State Variable

State variable appears to be unused. No analysis has been performed to see if any inline assembly references it. Consider removing this unused variable.

<details><summary>1 Found Instances</summary>


- Found in contracts/diamond/ScrumPokerDiamond.sol [Line: 32](contracts/diamond/ScrumPokerDiamond.sol#L32)

	```solidity
	    bool private _locked;
	```

</details>



## L-7: Uninitialized Local Variable

Initialize all the variables. If a variable is meant to be initialized to zero, explicitly set it to zero to improve code readability.

<details><summary>1 Found Instances</summary>


- Found in contracts/diamond/facets/CeremonyFacet.sol [Line: 293](contracts/diamond/facets/CeremonyFacet.sol#L293)

	```solidity
	        uint256 length;
	```

</details>



## L-8: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>3 Found Instances</summary>


- Found in contracts/diamond/ScrumPokerStorage.sol [Line: 357](contracts/diamond/ScrumPokerStorage.sol#L357)

	```solidity
	        for (uint256 i = 0; i < legacyCeremony.participants.length; i++) {
	```

- Found in contracts/diamond/facets/VotingFacet.sol [Line: 203](contracts/diamond/facets/VotingFacet.sol#L203)

	```solidity
	                for (uint256 i = 0; i < ds._deprecatedFunctionalitySessions[_code].length; i++) {
	```

- Found in contracts/diamond/facets/VotingFacet.sol [Line: 318](contracts/diamond/facets/VotingFacet.sol#L318)

	```solidity
	        for (uint256 i = 0; i < ceremony.participants.length; i++) {
	```

</details>



## L-9: State Change Without Event

There are state variable changes in this function but no event is emitted. Consider emitting an event to enable offchain indexers to track the changes.

<details><summary>1 Found Instances</summary>


- Found in contracts/diamond/facets/VotingFacet.sol [Line: 245](contracts/diamond/facets/VotingFacet.sol#L245)

	```solidity
	    function closeFunctionalityVote(string memory _code, uint256 _sessionIndex) 
	```

</details>



